<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="G√©n√®re une grille de coloriage magique √† partir d'une image et permet d'√©diter manuellement les ennonc√©s pour chaques rectangle de chaque couleur." />
  <title>Coloriage Magique</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <noscript>
    <div style="padding:12px;background:#fee2e2;color:#7f1d1d;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif">
      Cette application n√©cessite JavaScript pour fonctionner.
    </div>
  </noscript>

<header class="container site-header" role="banner">
  <img src="./logocolo.png" alt="Logo Coloriage Magique" class="site-logo" />
  <div>
    <h1>Coloriage Magique</h1>
    <p class="muted">G√©n√®re une grille de coloriage magique √† partir d'une image et permet d'√©diter manuellement les √©nonc√©s pour chaque rectangle de chaque couleur.</p>
  </div>
</header>

  <main class="container grid" role="main">
    <!-- ================= Colonne gauche : contr√¥les ================= -->
    <section class="card" aria-labelledby="controls-title">
      <h2 id="controls-title" class="visually-hidden">Contr√¥les</h2>

      <!-- Bloc A ‚Äî Aper√ßu (repliable) -->
      <details class="panel" id="panel-top" open>
        <summary class="panel-head">
          <div class="panel-title">Aper√ßu de l'image</div>
        </summary>
        <div class="panel-body">
          <div class="preview preview-wide" aria-live="polite">
            <canvas id="pixelPreview" aria-label="Aper√ßu pixellis√©"></canvas>
          </div>
        </div>
      </details>

<!-- Bloc B ‚Äî Projet (repliable) -->
<details class="panel" id="panel-project" open>
  <summary class="panel-head">
    <div class="panel-title">Projet</div>
  </summary>

  <!-- Sous-bloc : Import de l'image -->
  <div class="panel-body">
    <div class="field">
      <label for="fileInput">Image (PNG, JPEG, WEBP, GIF, BMP)</label>
      <div class="uploader">
        <label class="uploader-btn">
          <input id="fileInput" name="fileInput" type="file" accept="image/*" />
          <span class="uploader-icon" aria-hidden="true">üìÅ</span>
          <span>Choisir une image</span>
        </label>
        <div class="uploader-meta">
          <span class="uploader-label muted">S√©lection&nbsp;:</span>
          <span id="fileInfo" class="uploader-name">Aucun fichier</span>
        </div>
      </div>
    </div>
  </div>

  <!-- fine s√©paration -->
  <div class="panel-divider" aria-hidden="true"></div>

  <!-- Sous-bloc : Import/Export du projet JSON -->
  <div class="panel-body">
    <div class="actions" style="gap:10px; flex-wrap:wrap;">
      <button id="exportProject" type="button" class="btn">Exporter projet (.json)</button>
      <label class="btn secondary" style="margin:0;">
        <input id="importProjectInput" type="file" accept="application/json" style="display:none;">
        Importer projet (.json)
      </label>
    </div>
  </div>
</details>


      <!-- Bloc C ‚Äî R√©glages (repliables) -->
      <details class="panel" id="panel-settings" open>
        <summary class="panel-head">
          <div class="panel-title">R√©glages</div>
        </summary>
        <div class="panel-body">
          <div class="row">
            <label class="checkbox" for="mergeSameColor">
              <input id="mergeSameColor" type="checkbox" checked />
              Fusionner cellules identiques 
            </label>
            <div class="field">
              <label for="cellPx">Taille des pixels : <span id="cellPxVal">36</span></label>
              <input id="cellPx" type="range" min="16" max="120" value="36" />
            </div>
          </div>

          <div class="field">
            <label for="cols">Nombre de pixels en largeur : <span id="colsVal">40</span></label>
            <input id="cols" type="range" min="10" max="120" value="40" />
          </div>

          <div class="field">
            <label for="numColors">Nombre de couleurs : <span id="numColorsVal">6</span></label>
            <input id="numColors" type="range" min="2" max="12" value="6" />
          </div>

          <div class="field">
            <label for="contrast">Contraste : <span id="contrastVal">0</span></label>
            <input id="contrast" type="range" min="-100" max="100" value="0" />
          </div>

          <div class="field">
            <label for="saturation">Saturation : <span id="saturationVal">0</span></label>
            <input id="saturation" type="range" min="-100" max="100" value="0" />
          </div>

          <p id="status" class="status" aria-live="polite"></p>
        </div>
      </details>

      <!-- Bloc D ‚Äî √âditeur de couleur -->
      <section class="panel" id="panel-editor">
        <div class="panel-head">
          <div class="panel-title">√âditeur d'√©nnonc√©s</div>
        </div>
        <div class="panel-body">
          <div id="paletteBlock" class="field" aria-live="polite" hidden>
            <p class="small muted">Choisis une couleur √† afficher dans la grille puis selectionner un rectangle</p>
            <div id="paletteList" class="palette"></div>
          </div>

          <div id="cellEditor" class="field" hidden>
            <label>Cellule s√©lectionn√©e</label>
            <div class="cellMeta small muted" id="cellMeta">Aucune</div>

            <label for="cellText">Texte dans la cellule</label>
            <input id="cellText" type="text" placeholder="ex: 7 + 3" />

            <div class="row" style="align-items:center; gap:10px; margin-top:8px;">
              <label for="cellFontPx" class="small muted" style="min-width:140px;">Taille du texte</label>
              <input id="cellFontPx" type="number" min="8" max="48" step="1" placeholder="auto" style="max-width:120px;">
          
              <small class="muted">Laisse vide pour taille automatique.</small>
            </div>
          </div>
        </div>
      </section>

      <!-- Bloc E ‚Äî Export -->
      <section class="panel" id="panel-export">
        <div class="panel-head">
          <div class="panel-title">Export</div>
        </div>
        <div class="panel-body">
          <div class="actions">
            <button id="exportPNG" type="button" class="btn">Voir le Coloriage</button>
        <div class="panel-body">
          <div id="paletteBlock" class="field" aria-live="polite" hidden>
            <p class="small muted">Affiche le coloriage dans un nouvel onglet pour l'enregistrer ou l'imprimer.</p>
            <div id="paletteList" class="palette"></div>
          </div>
          </div>
        </div>
      </section>

</section>




    <!-- ================= Colonne droite : grille ================= -->
    <section class="card" aria-labelledby="grid-title">
      <div class="card-head">
        <h2 id="grid-title">Grille (SVG)</h2>
      </div>

      <!-- Barre de zoom -->
      <div class="zoomBar">
        <button id="zoomOut" class="btn secondary" type="button" title="Zoom out">‚àí</button>
        <button id="zoomIn"  class="btn secondary" type="button" title="Zoom in">+</button>
        <button id="zoomReset" class="btn secondary" type="button" title="Remettre √† 100%">100%</button>
        <span class="zoomInfo small muted" id="zoomLabel">100%</span>
      </div>

      <!-- Fen√™tre d‚Äôaper√ßu scrollable -->
      <div class="svgWrap">
        <div id="svgContainer" class="svgContainer" role="img" aria-label="Grille de coloriage g√©n√©r√©e"></div>
      </div>

      <!-- R√©sultats par couleur (sous la grille) -->
      <div id="resultsInline" class="resultsInline" hidden>
        <h3 class="resultsTitle">R√©sultats par couleur</h3>
        <div id="resultsList" class="results"></div>
        <div class="actions">
          <button id="resetResults" type="button" class="btn secondary">R√©initialiser</button>
        </div>
        <p class="muted small">
          Ces valeurs (texte autoris√©) d√©crivent chaque couleur. Elles apparaissent dans la l√©gende de l‚Äôexport PNG.
        </p>
      </div>
    </section>
  </main>

  <!-- Canvas cach√© pour le traitement -->
  <canvas id="work" class="hidden" aria-hidden="true"></canvas>

  <script type="module" src="./app.js" defer></script>
</body>
</html>



